#!/usr/bin/env sh
. /app/opt/runit/functions

is_cmd_exist() {
    which $1 1>/dev/null 2>&1
}

check_dependences() {
    local deps=""
    if ! is_cmd_exist sv; then
        deps="runit $deps"
    fi

    # busybox date 不能输出毫秒（纳米）
    if [ -z "$(date +%N)" ]; then
        deps="coreutils $deps"
    fi

    if [ -n "$deps" ]; then
        runit_info "NOTE: Install Dependences: $deps"
        if is_cmd_exist apk; then
            apk add --no-cache -q --no-progress $deps
        elif is_cmd_exist apt; then
            apt-get update -qq
            apt-get install -y -qq $deps
        else
            runit_info "WARNING: Install Dependences FAIL"
        fi
    fi
}

if [ ! -d "$SVDIR" ]; then
    mkdir -p "$SVDIR"
fi

check_dependences
